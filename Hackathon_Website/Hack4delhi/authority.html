<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authority Dashboard - Delhi Water-Logging System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar" id="main-navbar">
        <!-- Navigation will be dynamically loaded based on role -->
    </nav>

    <!-- Dashboard Header -->
    <section class="dashboard-header">
        <div class="container">
            <h1>MCD Authority Dashboard</h1>
            <p>Priority-based ward monitoring and intelligent action recommendations</p>
            <div class="last-updated">Last Updated: <span id="current-time"></span></div>
        </div>
    </section>

    <!-- Summary Cards - Key Metrics -->
    <section class="summary-section">
        <div class="container">
            <div class="summary-grid">
                <div class="summary-card critical">
                    <h3>Critical Wards</h3>
                    <div class="summary-number" id="critical-count">--</div>
                    <p>Risk Score > 80</p>
                </div>
                <div class="summary-card warning">
                    <h3>High Priority</h3>
                    <div class="summary-number" id="high-priority-count">--</div>
                    <p>Risk Score 50-80</p>
                </div>
                <div class="summary-card stable">
                    <h3>Monitoring Only</h3>
                    <div class="summary-number" id="monitoring-count">--</div>
                    <p>Risk Score < 50</p>
                </div>
                <div class="summary-card info">
                    <h3>Total Wards</h3>
                    <div class="summary-number" id="total-wards">--</div>
                    <p>Under Surveillance</p>
                </div>
            </div>
        </div>
    </section>

    <!-- AI-Based Recommendations -->
    <section class="ai-recommendations-section">
        <div class="container">
            <h2>ü§ñ AI-Powered Action Prioritization</h2>
            <div class="ai-card">
                <div class="ai-header">
                    <span class="ai-badge">AI ENGINE</span>
                    <h3>Intelligent Decision Support System</h3>
                </div>
                <div class="recommendation-rules">
                    <!-- Critical Rule -->
                    <div class="rule-item critical-rule">
                        <div class="rule-icon">üö®</div>
                        <div class="rule-content">
                            <h4>Critical Action Required (Risk Score > 80)</h4>
                            <ul>
                                <li>Deploy high-capacity water pumps immediately to affected areas</li>
                                <li>Issue traffic diversion alerts via SMS and public announcement systems</li>
                                <li>Activate emergency response teams and pre-position rescue equipment</li>
                                <li>Send real-time alerts to residents and commuters in the zone</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Warning Rule -->
                    <div class="rule-item warning-rule">
                        <div class="rule-icon">‚ö†Ô∏è</div>
                        <div class="rule-content">
                            <h4>High Priority Actions (Risk Score 50-80)</h4>
                            <ul>
                                <li>Schedule comprehensive drain inspection within 24 hours</li>
                                <li>Pre-position pumping equipment at strategic locations</li>
                                <li>Clear drainage blockages and remove debris from channels</li>
                                <li>Monitor rainfall forecasts and increase surveillance frequency</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Stable Rule -->
                    <div class="rule-item stable-rule">
                        <div class="rule-icon">‚úÖ</div>
                        <div class="rule-content">
                            <h4>Monitoring Mode (Risk Score < 50)</h4>
                            <ul>
                                <li>Continue routine monitoring and data collection</li>
                                <li>Maintain regular preventive maintenance schedule</li>
                                <li>No immediate emergency action required</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Wards Data Table -->
    <section class="wards-table-section">
        <div class="container">
            <h2>All Wards - Sorted by Risk Level</h2>
            <div class="table-controls">
                <button class="filter-btn active" onclick="filterTable('all')">All Wards</button>
                <button class="filter-btn" onclick="filterTable('critical')">Critical Only</button>
                <button class="filter-btn" onclick="filterTable('high')">High Priority</button>
            </div>
            <div class="table-container">
                <table class="wards-table" id="wards-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Ward Name</th>
                            <th>Risk Score</th>
                            <th>Risk Level</th>
                            <th>Rainfall</th>
                            <th>Drainage</th>
                            <th>Incidents</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="wards-table-body">
                        <!-- Generated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Priority Action Checklist -->
    <section class="checklist-section">
        <div class="container">
            <h2>Priority Action Checklist</h2>
            <div class="checklist-card">
                <div id="action-checklist">
                    <!-- Generated dynamically -->
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2026 Delhi Water-Logging Monitoring System</p>
        </div>
    </footer>

    <!-- Load Data and Scripts -->
    <script src="data.js"></script>
    <script src="script.js"></script>
    <script src="auth.js"></script>
    <script>
        // Initialize dashboard when page loads
        window.addEventListener('DOMContentLoaded', function() {
            initializeRoleBasedNavigation('authority');
            initializeTheme();
            initializeDashboard();
        });

        function initializeRoleBasedNavigation(activePage) {
            const session = SessionManager.getSession();
            const navbar = document.getElementById('main-navbar');
            
            if (!session) {
                window.location.href = 'portal.html';
                return;
            }

            if (session.role === 'admin') {
                navbar.innerHTML = `
                    <div class="container">
                        <div class="nav-brand">
                            <span class="nav-logo">üíß</span>
                            <h2>Delhi Water-Logging System - Admin</h2>
                        </div>
                        <div class="nav-content">
                            <div class="nav-links">
                                <a href="admin-home.html">Admin Home</a>
                                <a href="map.html">üó∫Ô∏è Flood Map</a>
                                <a href="complaint.html">üìù Register Complaint</a>
                                <a href="track.html">üîç Track Complaint</a>
                                <a href="my-complaints.html">üìã All Complaints</a>
                                <a href="admin-complaints.html">‚ö° Manage Complaints</a>
                                <a href="authority.html" class="${activePage === 'authority' ? 'active' : ''}">üèõÔ∏è Authority Dashboard</a>
                            </div>
                            <div class="nav-controls">
                                <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: var(--bg-secondary); border-radius: var(--radius-full); border: 1px solid var(--border-color);">
                                    <span style="font-size: 1rem;">üèõÔ∏è</span>
                                    <span style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">${session.username || 'Admin'}</span>
                                </div>
                                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle">
                                    <span class="icon" id="theme-icon">üåô</span>
                                    <span id="theme-text">Dark</span>
                                </button>
                                <button class="btn btn-danger" onclick="logout()" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                                    üö™ Logout
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Citizens should not access this page - redirect
                window.location.href = 'citizen-home.html';
            }
        }
    </script>
</body>
</html>